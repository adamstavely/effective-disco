<div class="task-card" 
     [class.has-border-color]="task.borderColor" 
     [class.selected]="selected"
     [class.bulk-selected]="isBulkMode && isSelected"
     [style.border-color]="task.borderColor || ''" 
     cdkDrag>
  <div class="bulk-checkbox" *ngIf="isBulkMode">
    <input 
      type="checkbox" 
      [checked]="isSelected"
      (change)="selectionChange.emit()"
      (click)="$event.stopPropagation()"
      class="checkbox-input"
    />
  </div>
  <div class="drag-handle" cdkDragHandle *ngIf="!isBulkMode">
    <lucide-icon name="grip-vertical" [size]="16" class="drag-icon"></lucide-icon>
  </div>
  <div class="task-content">
    <div class="task-header">
      <div class="task-title">{{ task.title }}</div>
      <div class="priority-badge" [class.priority-high]="task.priority === 'high'" 
           [class.priority-medium]="task.priority === 'medium'" 
           [class.priority-low]="task.priority === 'low'">
        {{ task.priority | titlecase }}
      </div>
    </div>
    <div class="task-description">{{ getDescriptionSnippet() }}</div>
    <div class="task-meta">
      <div class="task-time-info">
        <span class="task-age">{{ task.createdAt | timeAgo }}</span>
        <span class="last-message" *ngIf="hasLastMessage()">
          Last message: {{ task.lastMessageAt! | timeAgo }}
        </span>
      </div>
      <div class="task-tags" *ngIf="hasTags()">
        <app-tag *ngFor="let tag of getVisibleTags()" [text]="tag"></app-tag>
        <span class="tags-more" *ngIf="getRemainingTagsCount() > 0">
          +{{ getRemainingTagsCount() }} more
        </span>
      </div>
    </div>
    <div class="task-footer">
      <div class="task-actions">
        <button 
          class="action-button play-button" 
          *ngIf="canResumeTask()"
          (click)="onPlayClick($event)"
          title="Resume task"
          type="button">
          <lucide-icon name="play" [size]="16"></lucide-icon>
        </button>
        <button 
          class="action-button archive-button" 
          (click)="onArchiveClick($event)"
          title="Archive task"
          type="button">
          <lucide-icon name="archive" [size]="16"></lucide-icon>
        </button>
      </div>
      <lucide-icon name="chevron-up" [size]="16" class="expand-icon"></lucide-icon>
    </div>
  </div>
</div>
