<div class="proposals">
  <div class="proposals-header">
    <app-panel-header title="PROPOSALS"></app-panel-header>
    <button class="create-proposal-btn" (click)="openCreateProposalDialog()" type="button">
      + Create Proposal
    </button>
  </div>
  
  <div class="proposals-tabs">
    <app-filter-button
      label="All"
      [count]="((pendingCount$ | async) || 0) + ((approvedCount$ | async) || 0) + ((rejectedCount$ | async) || 0)"
      [active]="selectedTab === 'all'"
      (clicked)="setTab('all')"
    ></app-filter-button>
    <app-filter-button
      label="Pending"
      [count]="(pendingCount$ | async) ?? 0"
      [active]="selectedTab === 'pending'"
      (clicked)="setTab('pending')"
    ></app-filter-button>
    <app-filter-button
      label="Approved"
      [count]="(approvedCount$ | async) ?? 0"
      [active]="selectedTab === 'approved'"
      (clicked)="setTab('approved')"
    ></app-filter-button>
    <app-filter-button
      label="Rejected"
      [count]="(rejectedCount$ | async) ?? 0"
      [active]="selectedTab === 'rejected'"
      (clicked)="setTab('rejected')"
    ></app-filter-button>
  </div>

  <div class="proposals-list">
    <ng-container *ngIf="proposals$ | async as proposals; else loading">
      <app-proposal-card
        *ngFor="let proposal of proposals"
        [proposal]="proposal"
        (approve)="onApprove($event)"
        (reject)="onReject($event)"
        (convertToTask)="onConvertToTask($event)"
      ></app-proposal-card>
      <div *ngIf="proposals.length === 0" class="empty-state">
        <p>No proposals found.</p>
      </div>
    </ng-container>
    <ng-template #loading>
      <div class="empty-state">
        <p>Loading proposals...</p>
      </div>
    </ng-template>
  </div>

  <!-- Create Proposal Dialog -->
  <div *ngIf="showCreateProposalDialog" class="dialog-overlay" (click)="closeCreateProposalDialog()">
    <div class="dialog" (click)="$event.stopPropagation()">
      <div class="dialog-header">
        <h3>Create New Proposal</h3>
        <button class="close-btn" (click)="closeCreateProposalDialog()" type="button">Ã—</button>
      </div>
      <div class="dialog-content">
        <div class="form-group">
          <label for="proposal-title">Title *</label>
          <input
            id="proposal-title"
            type="text"
            [(ngModel)]="newProposalTitle"
            placeholder="Enter proposal title"
            class="form-input"
            [disabled]="isCreatingProposal"
          />
        </div>
        <div class="form-group">
          <label for="proposal-description">Description *</label>
          <textarea
            id="proposal-description"
            [(ngModel)]="newProposalDescription"
            placeholder="Describe what needs to be done"
            rows="5"
            class="form-textarea"
            [disabled]="isCreatingProposal"
          ></textarea>
        </div>
        <div class="form-group">
          <label for="proposal-priority">Priority</label>
          <select
            id="proposal-priority"
            [(ngModel)]="newProposalPriority"
            class="form-select"
            [disabled]="isCreatingProposal"
          >
            <option value="low">Low</option>
            <option value="medium">Medium</option>
            <option value="high">High</option>
          </select>
        </div>
      </div>
      <div class="dialog-actions">
        <button class="btn-cancel" (click)="closeCreateProposalDialog()" [disabled]="isCreatingProposal" type="button">
          Cancel
        </button>
        <button
          class="btn-primary"
          (click)="onCreateProposal()"
          [disabled]="!newProposalTitle.trim() || !newProposalDescription.trim() || isCreatingProposal"
          type="button"
        >
          {{ isCreatingProposal ? 'Creating...' : 'Create Proposal' }}
        </button>
      </div>
    </div>
  </div>
</div>
